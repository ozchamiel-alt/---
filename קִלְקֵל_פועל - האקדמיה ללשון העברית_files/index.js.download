(()=>{"use strict";const e=class{constructor(){this.searchInput=document.querySelector(".search-field"),this.searchInput&&(this.searchInput.setAttribute("autocomplete","off"),this.autocompleteList=document.createElement("ul"),this.autocompleteList.className="autocomplete-list",this.autocompleteList.id="ui-id-1",this.autocompleteList.setAttribute("tabindex","0"),this.autocompleteList.classList.add("ui-menu","ui-widget","ui-widget-content","ui-autocomplete","ui-front"),this.autocompleteList.setAttribute("unselectable","on"),this.searchInput.parentNode.appendChild(this.autocompleteList),this.searchInput.addEventListener("input",this.debounce(this.handleInput.bind(this),300)),this.searchInput.addEventListener("keydown",this.handleKeyDown.bind(this)),this.selectedIndex=-1,this.acApiUrl=this.getApiUrl(),this.searchForm=this.searchInput.closest("form"),this.searchForm&&this.searchForm.addEventListener("submit",this.handleFormSubmit.bind(this)))}getApiUrl(){return"https://kalanit.hebrew-academy.org.il/api/Ac/?SearchString="}async handleInput(){const e=this.searchInput.value.trim();if(e.length>0)try{const t=await this.fetchResults(e);this.showAutocomplete(t)}catch(e){console.error("Error fetching autocomplete results:",e)}else this.hideAutocomplete()}handleKeyDown(e){const t=this.autocompleteList.querySelectorAll(".ui-menu-item");switch(e.key){case"ArrowDown":e.preventDefault(),this.selectedIndex=(this.selectedIndex+1)%t.length,this.highlightItem(t);break;case"ArrowUp":e.preventDefault(),this.selectedIndex=(this.selectedIndex-1+t.length)%t.length,this.highlightItem(t);break;case"Enter":e.preventDefault(),-1!==this.selectedIndex?this.selectItem(t[this.selectedIndex]):this.handleFreeSearch()}}handleFormSubmit(e){e.preventDefault(),this.handleFreeSearch()}handleFreeSearch(){const e=this.searchInput.value.trim();e&&(window.location.href=`/?s=${encodeURIComponent(e)}`)}highlightItem(e){e.forEach((e,t)=>{t===this.selectedIndex?(e.classList.add("ui-state-hover"),e.scrollIntoView({block:"nearest"})):e.classList.remove("ui-state-hover")})}selectItem(e){if(e.classList.contains("free-search"))this.handleFreeSearch();else{const t=e.querySelector(".keyword-hidden");let i=t?t.value:e.textContent.trim();if(i){let e=encodeURIComponent(i);e=e.replace(/\(/g,"%28").replace(/\)/g,"%29");const t=`/דף-מילה/${e}/`;i.includes("(")&&!e.includes("%28")&&console.error("ERROR: Opening parenthesis not encoded!"),i.includes(")")&&!e.includes("%29")&&console.error("ERROR: Closing parenthesis not encoded!"),window.location.href=t}}}async fetchResults(e){const t=await fetch(`${this.acApiUrl}${encodeURIComponent(e)}`);if(!t.ok)throw new Error("Network response was not ok");return await t.json()}showAutocomplete(e){this.autocompleteList.innerHTML="";const t=document.createElement("li");t.className="ui-menu-item free-search";const i=document.createElement("div");i.className="ui-menu-item-wrapper",i.textContent=`חיפוש חופשי: ${this.searchInput.value.trim()}`,i.addEventListener("click",e=>{e.preventDefault(),window.location.href=`/?s=${encodeURIComponent(this.searchInput.value.trim())}/`}),t.appendChild(i),this.autocompleteList.appendChild(t),e.forEach((e,t)=>{const i=document.createElement("li");i.className="ui-menu-item";const s=document.createElement("div");s.id=`ui-id-${t+2}`,s.className="ui-menu-item-wrapper",s.setAttribute("tabindex","-1"),s.textContent=e.title;const n=document.createElement("input");n.type="hidden",n.className="keyword-hidden";let o=e.keyword||e.keywordWithoutNikud||e.title||"";n.value=o,i.appendChild(s),i.appendChild(n),this.autocompleteList.appendChild(i)}),this.autocompleteList.addEventListener("click",e=>{const t=e.target.closest(".ui-menu-item");t&&(e.preventDefault(),this.selectItem(t))}),this.autocompleteList.style.display=e.length>0?"block":"none",this.selectedIndex=-1}hideAutocomplete(){this.autocompleteList.style.display="none",this.selectedIndex=-1}debounce(e,t){let i;return function(...s){clearTimeout(i),i=setTimeout(()=>e.apply(this,s),t)}}},t=class{constructor(){this.menuContainer=document.querySelector("#site-navigation"),this.topLevelItems=this.menuContainer.querySelectorAll("ul.menu > li.menu-item-has-children"),this.minWidth=1024,this.isDesktopInitialized=!1,this.handleResize=this.handleResize.bind(this),this.handleTopLevelItemClick=this.handleTopLevelItemClick.bind(this),this.handleMenuClick=this.handleMenuClick.bind(this),this.init()}init(){window.innerWidth>this.minWidth&&(this.isDesktopInitialized=!0,this.initializeDesktopMenu()),window.addEventListener("resize",()=>{window.innerWidth>this.minWidth&&!this.isDesktopInitialized?(this.isDesktopInitialized=!0,this.initializeDesktopMenu()):window.innerWidth<=this.minWidth&&this.isDesktopInitialized?(this.isDesktopInitialized=!1,this.destroyDesktopMenu()):window.innerWidth>this.minWidth&&this.handleResize()})}initializeDesktopMenu(){this.addEventListeners(),this.isHomePage()?this.removeAllClasses():(this.applySavedState(),this.handleURLNavigation()),setTimeout(()=>this.handleResize(),1e3)}destroyDesktopMenu(){this.removeAllClasses(),this.topLevelItems.forEach(e=>{e.removeEventListener("click",this.handleTopLevelItemClick)}),this.menuContainer.removeEventListener("click",this.handleMenuClick),window.removeEventListener("resize",this.handleResize),localStorage.removeItem("menuState")}isDesktopMode(){return window.innerWidth>this.minWidth}isHomePage(){return"/"===window.location.pathname||"/index.php"===window.location.pathname}handleURLNavigation(){if(!this.isDesktopMode())return;const e=window.location.pathname;let t=!1;const i=s=>{for(const n of s){const s=n.querySelector("a");if(s){const i=s.getAttribute("href"),o=new URL(i,window.location.origin).pathname;if(e===o)return this.selectMenuItemByURL(n),t=!0,!0}const o=n.querySelector("ul.sub-menu");if(o){const e=o.querySelectorAll("li");if(i(e))return!0}}return!1};if(i(this.menuContainer.querySelectorAll("ul.menu > li")),!t){const i=e.split("/").filter(e=>e);for(;i.length>0;){const e="/"+i.join("/"),s=this.menuContainer.querySelectorAll("a");for(const i of s){const s=i.getAttribute("href");if(e===new URL(s,window.location.origin).pathname){this.selectMenuItemByURL(i.closest("li")),t=!0;break}}if(t)break;i.pop()}}t||(this.removeAllClasses(),localStorage.removeItem("menuState"))}selectMenuItemByURL(e){if(!this.isDesktopMode())return;this.removeAllClasses();let t=e;for(;t.parentElement&&!t.parentElement.classList.contains("menu");)t=t.parentElement;this.selectMenuItem(t);const i=e.querySelector("a");i&&(this.menuContainer.querySelectorAll("a.red").forEach(e=>e.classList.remove("red")),i.classList.add("red")),this.saveMenuState()}removeAllClasses(){if(this.menuContainer&&(this.menuContainer.querySelectorAll("li.menu-item-selected").forEach(e=>e.classList.remove("menu-item-selected")),this.menuContainer.querySelectorAll("ul.submenu-active").forEach(e=>e.classList.remove("submenu-active")),this.menuContainer.querySelectorAll("a.red").forEach(e=>e.classList.remove("red")),this.menuContainer.querySelectorAll("ul.sub-menu").forEach(e=>{e.style.removeProperty("left"),e.style.removeProperty("width")}),this.searchBlock)){const e=this.menuContainer.querySelector("ul.submenu-active");if(e){const t=e.getBoundingClientRect();this.searchBlock.style.marginTop=`${t.height}px`}else this.searchBlock.style.marginTop=""}}addEventListeners(){this.isDesktopMode()&&(this.topLevelItems.forEach(e=>{e.addEventListener("click",t=>this.handleTopLevelItemClick(t,e))}),this.menuContainer.addEventListener("click",this.handleMenuClick))}toggleBodyClass(e){e?document.body.classList.add("submenu-open"):document.body.classList.remove("submenu-open")}handleTopLevelItemClick(e,t){this.isDesktopMode()&&(e.preventDefault(),t.classList.contains("menu-item-selected")?this.selectMenuItem(null):this.selectMenuItem(t),this.saveMenuState())}handleMenuClick(e){if(!this.isDesktopMode())return;const t=e.target.closest("li");if(t){const i=t.querySelector("a");if(i&&i.getAttribute("href")){e.preventDefault();let s=t;for(;s.parentElement&&!s.parentElement.classList.contains("menu");)s=s.parentElement;this.selectMenuItem(s),this.menuContainer.querySelectorAll("a.red").forEach(e=>e.classList.remove("red")),i.classList.add("red"),this.saveMenuState(),window.location.href=i.href}}}selectMenuItem(e){if(this.isDesktopMode()){if(this.menuContainer.querySelectorAll("li.menu-item-selected").forEach(e=>e.classList.remove("menu-item-selected")),this.menuContainer.querySelectorAll("ul.submenu-active").forEach(e=>{e.classList.remove("submenu-active"),e.style.removeProperty("left"),e.style.removeProperty("width")}),this.toggleBodyClass(!1),e){let t=e,i=null;for(;t&&!t.classList.contains("menu");)t.classList.contains("menu-item-has-children")&&(t.classList.add("menu-item-selected"),i||(i=t.querySelector(":scope > ul.sub-menu"))),t=t.parentElement,"UL"===t.tagName&&t.classList.contains("sub-menu")&&(t=t.parentElement);i&&(i.classList.add("submenu-active"),this.positionSubmenu(e,i),this.toggleBodyClass(!0))}this.saveMenuState()}}handleDocumentClick(e){this.isDesktopMode()&&(e.target.closest("#site-navigation")||(this.selectMenuItem(null),this.saveMenuState()))}saveMenuState(){if(!this.isDesktopMode())return;const e={path:window.location.pathname,selectedItems:Array.from(this.menuContainer.querySelectorAll("li.menu-item-selected")).map(e=>this.getItemPath(e)),activeSubmenus:Array.from(this.menuContainer.querySelectorAll("ul.submenu-active")).map(e=>this.getItemPath(e)),redAnchor:this.getItemPath(this.menuContainer.querySelector("a.red"))};localStorage.setItem("menuState",JSON.stringify(e))}getItemPath(e){if(!e)return null;const t=[];let i=e;for(;i&&i!==this.menuContainer;){const e=Array.from(i.parentElement.children).indexOf(i);t.unshift(e),i=i.parentElement}return t}getElementByPath(e){if(!e)return null;let t=this.menuContainer;for(const i of e)if(t=t.children[i],!t)return null;return t}applySavedState(){if(!this.isDesktopMode())return;const e=localStorage.getItem("menuState");if(e){const t=JSON.parse(e),i=window.location.pathname;if(t.path===i){this.menuContainer.querySelectorAll("li.menu-item-selected").forEach(e=>e.classList.remove("menu-item-selected")),this.menuContainer.querySelectorAll("ul.submenu-active").forEach(e=>e.classList.remove("submenu-active")),this.menuContainer.querySelectorAll("a.red").forEach(e=>e.classList.remove("red")),t.selectedItems.forEach(e=>{const t=this.getElementByPath(e);t&&t.classList.add("menu-item-selected")}),t.activeSubmenus.forEach(e=>{const t=this.getElementByPath(e);t&&t.classList.add("submenu-active")});const e=this.getElementByPath(t.redAnchor);e&&e.classList.add("red"),this.handleResize()}else localStorage.removeItem("menuState")}}positionSubmenu(e,t){if(this.isDesktopMode())if(window.innerWidth>960){const i=document.querySelector("#header-wrap");if(i){const s=i.getBoundingClientRect(),n=e.getBoundingClientRect();t.style.left=s.left-n.left+"px",t.style.width=`${s.width}px`}}else t.style.left="",t.style.width=""}handleResize(){this.isDesktopMode()&&this.menuContainer.querySelectorAll("ul.menu > li.menu-item-selected").forEach(e=>{const t=e.querySelector(":scope > ul.sub-menu.submenu-active");t&&this.positionSubmenuOnly(e,t)})}positionSubmenuOnly(e,t){if(this.isDesktopMode())if(window.innerWidth>960){const i=document.querySelector("#header-wrap");if(i){const s=i.getBoundingClientRect(),n=e.getBoundingClientRect();t.style.left=s.left-n.left+"px",t.style.width=`${s.width}px`}}else t.style.left="",t.style.width=""}},i=class{constructor(){this.hamburgerIcon=document.querySelector(".hamburger-icon"),this.headerWrap=document.querySelector("#header-wrap"),this.menuItems=document.querySelectorAll("#header-wrap .menu-item-has-children"),this.createOverlay(),this.wasDesktop=window.innerWidth>1024,this.modifyMenuLinks(),this.init()}init(){this.hamburgerIcon&&this.headerWrap&&this.addEventListeners()}addEventListeners(){this.hamburgerIcon.addEventListener("click",e=>{e.stopPropagation(),this.hamburgerIcon.classList.contains("active")?this.closeMenu():this.toggleMenu()}),document.querySelectorAll("#header-wrap .menu-item-has-children").forEach(e=>{const t=e.querySelector("a");t&&t.addEventListener("click",t=>{if(window.innerWidth<=1024){if(t.target.closest(".link-text-wrapper"))return;t.preventDefault(),t.stopPropagation(),this.toggleSubMenu(e)}},!0)}),document.addEventListener("click",e=>{!this.headerWrap.contains(e.target)&&!this.hamburgerIcon.contains(e.target)&&window.innerWidth<=1024&&this.closeMenu()}),window.addEventListener("resize",()=>{window.innerWidth>1024?(this.hamburgerIcon.classList.remove("active"),this.headerWrap.classList.remove("active"),this.overlay.classList.remove("active"),document.body.style.overflow=""):window.innerWidth<=1024&&this.wasDesktop&&this.resetMenu(),this.wasDesktop=window.innerWidth>1024})}toggleSubMenu(e){const t=e.querySelector(".sub-menu");if(t){const i=e.parentElement.children;Array.from(i).forEach(t=>{if(t!==e){const e=t.querySelector(".sub-menu");e&&e.classList.remove("submenu-active"),t.classList.remove("menu-item-selected")}}),t.classList.toggle("submenu-active"),e.classList.toggle("menu-item-selected"),t.classList.contains("submenu-active")&&t.querySelectorAll(".sub-menu").forEach(e=>{e.classList.remove("submenu-active"),e.parentElement&&e.parentElement.classList.remove("menu-item-selected")})}}toggleMenu(){this.hamburgerIcon.classList.toggle("active"),this.headerWrap.classList.toggle("active"),this.overlay.classList.toggle("active"),document.body.style.overflow=this.headerWrap.classList.contains("active")?"hidden":""}closeMenu(){this.hamburgerIcon.classList.remove("active"),this.headerWrap.classList.remove("active"),this.overlay.classList.remove("active"),document.body.style.overflow="",this.headerWrap.querySelectorAll(".sub-menu").forEach(e=>{e.classList.remove("submenu-active")}),this.headerWrap.querySelectorAll(".menu-item-has-children").forEach(e=>{e.classList.remove("menu-item-selected")})}resetMenu(){this.closeMenu()}modifyMenuLinks(){document.querySelectorAll("#header-wrap .menu-item-has-children a").forEach(e=>{if(!e.querySelector(".link-text-wrapper")){const t=e.textContent;e.innerHTML="";const i=document.createElement("div");i.className="link-text-wrapper",i.textContent=t,e.appendChild(i)}})}createOverlay(){if(!document.querySelector(".menu-overlay")){const e=document.createElement("div");e.className="menu-overlay",document.body.appendChild(e)}this.overlay=document.querySelector(".menu-overlay")}},s=class{constructor(){this.posts=document.querySelectorAll(".home-post"),this.resizeTimeout=null,this.adjustTextLines=this.adjustTextLines.bind(this),this.handleResize=this.handleResize.bind(this),this.init=this.init.bind(this)}adjustTextLines(){this.posts.forEach(e=>{const t=e.querySelector(".home-post-content"),i=t?.querySelector("p"),s=t?.querySelector(".title");if(!i||!t||!s)return;i.style.webkitLineClamp="none";const n=e.offsetHeight-(s.offsetTop+s.offsetHeight)-20,o=parseFloat(getComputedStyle(i).lineHeight),r=Math.floor(n/o);i.style.webkitLineClamp=Math.max(2,r)})}resetLineClamp(){this.posts.forEach(e=>{const t=e.querySelector(".home-post-content"),i=t?.querySelector("p");i&&(i.style.webkitLineClamp="none",i.style.display="")})}handleResize(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.adjustTextLines,100)}observeContentChanges(){const e=new MutationObserver(this.adjustTextLines),t=document.querySelector(".home-posts");t&&e.observe(t,{childList:!0,subtree:!0})}init(){this.adjustTextLines(),window.addEventListener("resize",this.handleResize),this.observeContentChanges()}destroy(){window.removeEventListener("resize",this.handleResize),clearTimeout(this.resizeTimeout),this.resetLineClamp()}},n=900;let o=null,r=null,l=window.innerWidth;function a(){r||(r=new e)}function c(){const e=window.innerWidth,t=l<=n,i=e>n;t&&i?(o=new s,o.init()):t||i||o&&(o.destroy(),o=null),l=e}a(),document.addEventListener("DOMContentLoaded",function(){new t,new i,a(),window.innerWidth>n&&(o=new s,o.init()),window.addEventListener("resize",c)}),window.addEventListener("load",function(){a(),window.innerWidth>n&&!o&&(o=new s,o.init())})})();